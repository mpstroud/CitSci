---
title: "CitSci exploratory"
output: html_document
---

1) Package load/retrieval
```{r,warning=F}
#necessary packages: 
pack_list<-list ("ggplot2","openair","dygraphs","xts","dataRetrieval","dplyr","forecast","lubridate", "expss")
for(i in 1:length(pack_list)){
  p <- pack_list[[i]]
  install.packages(p,repos = "https://cran.rstudio.com",dependencies = TRUE)
}
```


2) Case count for site selection
```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)  
library(lubridate)
library(xts)
library(tidyverse)
library(dygraphs)
library(forecast)
library(timeSeries)
library(glue)
library(expss)
detach("package:dplyr", unload=TRUE) : library(dplyr)
options(stringsAsFactors = FALSE)

setwd("~/Library/Mobile Documents/com~apple~CloudDocs/files")
setwd("C:/Users/admin/iCloudDrive/files")

#Individial site analysis. Input specs first and check output_lists for results
data <- read.csv("PUWC1S.csv")
thermal_setpoint = 20
################################################# create a workable datetime vector with :lubridate:
data2 <- select(data,c(sitecode,dateEST,TimeEST,depth_mm,temp_degc))
data2$dateEST <- as.Date(data2$dateEST, format = "%d %B %y") #output is YYYY-mm-dd
data2$dateEST <- as.character(data2$dateEST) ; data2$TimeEST <- as.character(data2$TimeEST)
data2$datetime <- paste(data2$dateEST, data2$TimeEST) ; data2$datetime <- ymd_hm(data2$datetime)
temp_data<-select(data2,c(sitecode,depth_mm,temp_degc,datetime))

################################################# create a month 
temp_data <- temp_data %>%
  mutate(year = year(datetime))  %>%
  mutate(month = month(datetime))  %>%
  mutate(day = day(datetime))
 
temp_summer_data <- temp_data %>%
  filter(month==c("6","7","8","9")) #this dataset will be kept as is#######    temp_summer_data

temp_summer_par <- temp_summer_data %>%
  group_by(year,month,day) %>%
  summarise_at("temp_degc", funs(min(., na.rm = TRUE), 
                                     mean(., na.rm = TRUE), 
                                     max(., na.rm = TRUE)))


pmt_names = colnames(data2[,3:9])
      for(i in 1:length(pmt_names)){
            pmt = pmt_names[i]
            daily_data[[i]]  = data2 %>% group_by(dateEST) %>%
            summarise_at(vars(pmt), funs(min(., na.rm = TRUE), 
                                     mean(., na.rm = TRUE), 
                                     max(., na.rm = TRUE)))
      }

################################################# interactive plot for daily data
for(i in 1:length(daily_data)){
            data3 = daily_data[[i]] 
            data3$dateEST<-as.Date(data3$dateEST, format = "%Y-%m-%d")
            daily_timeseries = xts(x = data3[,-1], order.by = data3$dateEST)
                    daily_plots[[i]] = dygraph(daily_timeseries,xlab = NULL, ylab = pmt_names[i]) %>%
                  dySeries(c("min", "mean", "max"))
      }

################################################# hours per day over a given threshold
data4 = select(data2,c(dateEST))
data4$Tcount = count_row_if(gt(thermal_setpoint), data2$temp_degc)
    hours_over = data4 %>% 
      group_by(dateEST) %>%
      summarise(Tcount = sum(Tcount)/12)

    


```



